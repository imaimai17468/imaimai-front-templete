# CLAUDE.md - プロジェクト全体ガイド

## 🚨 AI エージェント向け重要事項

### プロジェクト構成と AI 分離方針

このプロジェクトは **Next.js + FastAPI** のフルスタック構成で、**スキーマ駆動開発** の原則に基づき、フロントエンド専用AIとバックエンド専用AIに分かれて開発することを前提としています。

#### 🎯 AI分離方針の意図

**なぜ分離するのか**:
- **専門性の向上**: 各AIが特定の技術スタックに集中することで、より深い専門知識を活用できる
- **認知負荷の軽減**: 膨大な命令プロンプトを専門領域別に分割し、AIの処理負荷と開発負担を大幅に削減
- **命令忘却の防止**: 専門領域に特化した短いドキュメントにより、重要なルールや制約を見落とすリスクを最小化
- **品質の向上**: 各領域固有のベストプラクティスとルールを徹底できる
- **開発効率の向上**: 並行開発が可能になり、相互の干渉を最小限に抑制

**どのように連携するか**:
- **API契約**: OpenAPI/JSON Schemaによる明確なインターフェース定義
- **型安全性**: バックエンドのPydanticモデルからフロントエンドのTypeScript型への変換
- **独立性**: 各AIは自身の専門領域内で完結した開発を行う
- **統合**: 定期的な統合テストによる連携確認

### 📋 AI 役割分担

#### フロントエンド専用 AI
- **対象**: `frontend/` ディレクトリ内のすべてのファイル
- **必読ドキュメント**: 
  - [`README.md`](./README.md) - プロジェクト全体概要（必読）
  - [`frontend/CLAUDE.md`](./frontend/CLAUDE.md) - フロントエンド専用指示
- **技術スタック**: Next.js 15, TypeScript, Tailwind CSS, shadcn/ui, Biome
- **責務**: UI/UX、コンポーネント設計、フロントエンドロジック

#### バックエンド専用 AI
- **対象**: `backend/` ディレクトリ内のすべてのファイル  
- **必読ドキュメント**: 
  - [`README.md`](./README.md) - プロジェクト全体概要（必読）
  - [`backend/CLAUDE.md`](./backend/CLAUDE.md) - バックエンド専用指示
- **技術スタック**: FastAPI, Python 3.11, PostgreSQL, SQLAlchemy, Ruff, mypy
- **責務**: API設計、データベース設計、ビジネスロジック

### 🔄 連携ルール

#### API スキーマ駆動開発
1. **API仕様の事前定義**: OpenAPI/JSON Schema による型定義
2. **型共有**: バックエンドのPydanticモデル → フロントエンドのTypeScript型
3. **独立開発**: 各AIは専用ドキュメントに従って独立して開発
4. **統合テスト**: 定期的な連携確認

#### スキーマ変更時の具体的手順
1. **バックエンドAI**: Pydanticモデル変更・検証
   - 新しいAPIモデルを定義
   - バリデーションルールを追加
   - APIエンドポイントに適用

2. **API仕様生成**: OpenAPIスキーマ自動更新
   - FastAPI自動生成スキーマを確認
   - スキーマの整合性を検証

3. **フロントエンドAI**: TypeScript型定義同期
   - 対応するTypeScript型定義を作成
   - 既存コンポーネントの型を更新

4. **統合テスト**: 両方のAIで連携確認
   - バックエンド: APIテスト実行
   - フロントエンド: 型チェック実行
   - 実際のAPI通信テスト

#### 厳格な境界ルール
- ❌ **フロントエンドAI**: `backend/` ディレクトリの操作を禁止
- ❌ **バックエンドAI**: `frontend/` ディレクトリの操作を禁止  
- ❌ **相互変更禁止**: 他方の専用CLAUDE.mdを変更しない
- ✅ **API仕様のみで連携**: OpenAPI/JSON Schemaを介した連携

#### 連携が必要なケース
- **新しいAPIエンドポイント追加**: バックエンド主導、フロントエンド対応
- **既存APIの仕様変更**: 破壊的変更は事前調整必須
- **認証・認可機能の実装**: セキュリティ要件の共有が必要
- **エラーハンドリングの統一**: 統一されたエラー形式の採用

#### 共通原則
- **日本語コミュニケーション**: すべてのやり取りは日本語
- **事前承認**: ファイル操作前の明示的な承認取得
- **品質重視**: 各環境の品質ツール（Biome/Ruff+mypy）の厳守
- **ドキュメント優先**: 専用CLAUDE.mdのルールが最優先

### 🚀 開始手順

#### フロントエンド開発を行う場合
```bash
# 1. プロジェクト全体概要を確認（必読）
cat README.md

# 2. フロントエンド専用ドキュメントを確認
cat frontend/CLAUDE.md

# 3. 環境構築が未完了の場合は、README.mdのクイックスタートに従う
# 問題発生時は TROUBLESHOOTING.md を参照

# 4. フロントエンド環境に移動
cd frontend

# 5. 開発開始
bun run dev
```

#### バックエンド開発を行う場合  
```bash
# 1. プロジェクト全体概要を確認（必読）
cat README.md

# 2. バックエンド専用ドキュメントを確認
cat backend/CLAUDE.md

# 3. 環境構築が未完了の場合は、README.mdのクイックスタートに従う
# 問題発生時は TROUBLESHOOTING.md を参照

# 4. バックエンド環境に移動
cd backend

# 5. 開発開始（Docker環境）
task docker:up
```

### ⚠️ AI分離開発での注意点

#### 境界遵守の重要性
- **フロントエンドAI**: `backend/` ディレクトリを操作しない
- **バックエンドAI**: `frontend/` ディレクトリを操作しない
- **相互変更禁止**: 専用CLAUDE.mdの相互変更を行わない

#### 作業範囲の判断基準
- **`frontend/` 内** → フロントエンドAI
- **`backend/` 内** → バックエンドAI  
- **プロジェクト直下共通ファイル** → 事前相談・調整
- **API仕様変更** → バックエンドAI主導、フロントエンドAI連携

#### 技術的問題発生時
- **システム・環境問題** → [TROUBLESHOOTING.md](./TROUBLESHOOTING.md) を参照
- **AI分離・連携問題** → 上記判断基準に従い適切なAIに依頼

### ⚠️ 重要な注意事項

1. **専用ドキュメント必読**: 作業前に必ず対応するCLAUDE.mdを読み込む
2. **境界の遵守**: フロントエンドAIはbackend/を、バックエンドAIはfrontend/を操作しない
3. **連携時の調整**: 両方に影響する変更は事前に調整が必要
4. **品質基準の統一**: 各環境の品質ツールを絶対に無視しない

### 📚 ドキュメント階層

```
プロジェクト全体
├── README.md (プロジェクト概要)
├── CLAUDE.md (このファイル - AI分離方針)
├── TROUBLESHOOTING.md (包括的なトラブルシューティング)
├── CI_CD.md (品質保証・CI/CDガイド)
├── frontend/
│   ├── README.md (フロントエンド詳細)
│   └── CLAUDE.md (フロントエンド専用AI向け)
└── backend/
    ├── README.md (バックエンド詳細)  
    └── CLAUDE.md (バックエンド専用AI向け)
```

---

**あなたの担当領域を確認し、適切な専用ドキュメントを読み込んでから作業を開始してください。**